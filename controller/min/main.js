window.controller={};var config={server:"game.neurron.com",port:"2020",pollingTimer:5,clearDelay:2e3,clearRate:30,commands:{REGISTER:1,NAME:2,MOVE:3,HEAL:4},protocolStoC:{START:1,STATUS:2},protocolCtoS:{REGISTER:1,TEAMNAME:2,CANCEL:3,RIGHT:4,LEFT:5,TOP:6,BOTTOM:7,CLOCKWISE:8,ANTICLOCKWISE:9,HEAL:10,POLLING:11},colors:{1:"red",2:"blue",3:"green",4:"yellow",5:"lila",6:"orange",7:"turq",8:"pink"},shadowColors:{red:{r:246,g:91,b:98},blue:{r:83,g:102,b:243},green:{r:162,g:251,b:91},yellow:{r:250,g:235,b:64},lila:{r:223,g:105,b:254},orange:{r:255,g:182,b:106},turq:{r:144,g:216,b:255},pink:{r:255,g:121,b:198}}};(function(){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=Array.prototype.slice.call(arguments,1),o=this,e=function(){},i=function(){return o.apply(this instanceof e&&t?this:t||window,n.concat(Array.prototype.slice.call(arguments)))};return e.prototype=this.prototype,i.prototype=new e,i}),Date.now||(Date.now=function(){return+new Date}),window.transitionend=function(){var t,n,o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"oTransitionEnd",transition:"transitionEnd"},e=document.createElement("div"),i=Object.keys(o);for(t=0,n=i.length;n>t;t++)if(void 0!==e.style[i[t]])return o[i[t]];console.log("TransitionEnd - is not supported")}()})(),function(){var t=controller.Manager=function(t){this.id=0,this.timer=0,this.url=t.url,this.channel=t.channel,this.req=new XMLHttpRequest,this.box=controller.Box.init(this.handle.bind(this)),this.input=controller.Input.init(this.handle.bind(this)),(this.channel>255||0>this.channel)&&this.box.warn(3)};t.prototype.showBox=function(t){this.repeat&&clearInterval(this.repeat),1===t?(this.id=0,this.box.start()):this.box.warn(t),this.input.active(!1)},t.prototype.startTimer=function(){this.repeat=setInterval(function(){this.timer++,this.timer===config.pollingTimer&&(this.timer=0,this.send(config.protocolCtoS.POLLING))}.bind(this),1e3)},t.prototype.handle=function(t,n){var o={1:this.register,2:this.name,3:this.move,4:this.heal};o[t].call(this,n)},t.prototype.name=function(t){this.input.active(!0),this.send(config.protocolCtoS.TEAMNAME,t)},t.prototype.register=function(){this.id||(this.startTimer(),this.req.onload=function(t){var n=t.currentTarget.responseText,o=n.length%4,e=n.substr(0,n.length-o),i=atob(e),r=i.charCodeAt(0);if(r===config.protocolStoC.STATUS){var a=i.charCodeAt(1);if(0===a)return;this.showBox(a)}if(r===config.protocolStoC.START){this.id=i.charCodeAt(1),this.input.setStyle(i.charCodeAt(2));var c=i.charCodeAt(3);0===c?this.box.hide(this.id):this.box.name()}}.bind(this),this.send(config.protocolCtoS.REGISTER))},t.prototype.move=function(t){controller.move(this,t)},t.prototype.heal=function(){this.send(config.protocolCtoS.HEAL)},t.prototype.send=function(t,n){this.timer=0,this.req.open("POST",this.url+"?t="+Date.now(),!0);var o=String.fromCharCode(this.channel,this.id,t)+(n||"");o=btoa(o),this.req.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),this.req.send(o)}}(),function(){controller.Screen=function(){function t(t){e=t}function n(){i.width=window.innerWidth,i.height=window.innerHeight,e&&e()}function o(){r.save(),r.clearRect(0,0,i.width,i.height),r.restore()}var e,i=document.createElement("canvas"),r=i.getContext("2d");return n(),document.body.appendChild(i),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),{init:t,cvs:i,ctx:r,clear:o}}()}(),function(){controller.Input=function(){function t(){d.addEventListener("touchstart",n),d.addEventListener("touchmove",o),d.addEventListener("touchend",e),d.addEventListener("touchcancel",c),d.addEventListener("touchleave",s)}function n(t){t.preventDefault(),t.stopPropagation(),T&&clearInterval(T),S&&clearTimeout(S),h.clearRect(0,0,d.width,d.height),p.length=0,T=null;var n=a(t.changedTouches[0]);f=n,y+=n.x,v+=n.y,p[0]=n,S=setTimeout(i,config.clearDelay)}function o(t){t.preventDefault(),t.stopPropagation();var n=a(t.changedTouches[0]);g.push(n),p.push(n),y+=n.x,v+=n.y,m++,x&&(S=setTimeout(i,config.clearDelay)),r()}function e(t){t.preventDefault(),t.stopPropagation();var n=a(t.changedTouches[0]);p.push(n),y/=m,v/=m,l(config.commands.MOVE,[f,n,y,v,g]),g.length=0,y=0,v=0,m=0}function i(){S=null,T||(x=!1,T=setInterval(function(){return p.length?(p=p.slice(1),h.clearRect(0,0,d.width,d.height),r(),void 0):(clearInterval(T),T=null,x=!0,void 0)},config.clearRate))}function r(){var t,n,o=p.length-2;if(h.beginPath(),E&&!(0>=o)){h.moveTo(p[0].x,p[0].y);for(var e=1;o>e;e++)t=(p[e].x+p[e+1].x)/2,n=(p[e].y+p[e+1].y)/2,h.quadraticCurveTo(p[e].x,p[e].y,t,n);h.quadraticCurveTo(p[e].x,p[e].y,p[e+1].x,p[e+1].y),h.stroke()}}function a(t){return{x:t.clientX||t.offsetX||t.layerX||t.pageX,y:t.clientY||t.offsetY||t.layerY||t.pageY}}function c(t){t.preventDefault(),t.stopPropagation()}function s(t){t.preventDefault(),t.stopPropagation()}var l,u=controller.Screen,d=u.cvs,h=u.ctx,f=null,p=[],g=[],y=0,v=0,m=0,C=null,E=!1,T=null,S=null,x=null,b=function(t){E=t},w=function(t){t&&(C=config.shadowColors[config.colors[t]]),h.lineWidth=10,h.lineCap="round",h.lineJoin="round",h.strokeStyle="#fff",h.shadowBlur=20,h.shadowColor=C?"rgb("+C.r+","+C.g+","+C.b+")":"#BAE9F7"},I=function(n){return"ontouchstart"in window&&(t(),w()),l=n,this};return u.init(w),{init:I,active:b,setStyle:w}}()}(),function(){controller.Box=function(){var t,n=document.getElementById("box"),o=document.getElementById("content"),e=document.getElementById("figure"),i={start:'<div id="start" class="button big">Start</div>',enterName:'				<div class="teamname">					<div class="info">Enter your Team-Name:</div>					<input id="input" type="name" class="input" autofocus />					<br>					<div id="skip" class="button small left">Skip</div>					<div id="okay" class="button small right">Okay</div>				</div>',notFound:'<div class="warning teamname">The Game does not exist !</div>',alreadyRunning:'<div class="warning teamname">The Game is already running !</div>'},r={start:function(){t(config.commands.REGISTER)},skip:function(){t(config.commands.NAME,""),l()},okay:function(){var n=document.getElementById("input").value.replace(/\n+/g,"").replace(/\t+/g,"");n.length&&(n=n.match(/[ -~]/g).join("")),t(config.commands.NAME,n),l()}};n.addEventListener("touchend",function(t){var n=t.target;n.id&&r[n.id]&&r[n.id]()});var a=function(n){return t=n,this},c=function(){n.className="box",o.innerHTML=i.start},s=function(){o.innerHTML=i.enterName},l=function(t){function i(){e.removeEventListener(transitionend,i),e.className="figure hide"}n.className="hide",o.innerHTML="",e.className="figure "+config.colors[t||1],setTimeout(function(){e.className="figure fade pound",e.addEventListener(transitionend,i)},16.7)},u=function(t){var n;2===t&&(n=i.alreadyRunning),3===t&&(n=i.notFound),o.innerHTML=n};return c(),{init:a,start:c,name:s,hide:l,warn:u}}()}(),function(){function t(t,n){var o,e,i,r,a=n[0],c=n[1],s=n[4],l=Math.abs(c.x-a.x),u=Math.abs(c.y-a.y),d={},h=0,f=0,p=0;i=(c.y-a.y)/(c.x-a.x),r=-1/i;for(var g=s.length,y=0;g>y;y++)d.x=s[y].x,d.y=s[y].y,0!==(c.y-a.y&&c.x-a.x)&&(o=(-d.x*r+d.y+a.x*i-a.y)/(i-r),e=r*(o-d.x)+d.y,h=(d.x-o)*(d.x-o)+(d.y-e)*(d.y-e)),l>u?a.y===c.y?(h=a.y-d.y,h*=a.x<c.x?1:-1):h*=a.x>c.x?d.y>e?1:-1:e>d.y?1:-1:u>l&&(a.x===c.x?(h=a.x-d.x,h*=a.y>c.y?1:-1):h*=a.y<c.y?d.x>o?1:-1:o>d.x?1:-1),f+=h;l>u?p=a.y===c.y?f>0?config.protocolCtoS.CLOCKWISE:config.protocolCtoS.ANTICLOCKWISE:a.x>c.x?f>0?config.protocolCtoS.CLOCKWISE:config.protocolCtoS.ANTICLOCKWISE:0>f?config.protocolCtoS.ANTICLOCKWISE:config.protocolCtoS.CLOCKWISE:u>l&&(p=a.x===c.x?f>0?config.protocolCtoS.CLOCKWISE:config.protocolCtoS.ANTICLOCKWISE:a.y<c.y?0>f?config.protocolCtoS.ANTICLOCKWISE:config.protocolCtoS.CLOCKWISE:f>0?config.protocolCtoS.CLOCKWISE:config.protocolCtoS.ANTICLOCKWISE),p===config.protocolCtoS.CLOCKWISE,t.send(p)}controller.move=t}(),function(){var t=window.location.search.substr(1);new controller.Manager({url:"http://"+config.server+":"+config.port,channel:t})}();